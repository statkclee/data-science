---
layout: page
title: ë°ì´í„° ê³¼í•™
subtitle: RStudio ê°œë°œí™˜ê²½ - í”„ë¡œì íŠ¸
date: "`r Sys.Date()`"
output:
  html_document: 
    toc: yes
    highlight: tango
  pdf_document:
    latex_engine: xelatex
editor_options: 
  chunk_output_type: console
mainfont: NanumGothic
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, verbose =TRUE, cache = FALSE, fig.width=12, fig.height = 10)

# 0. í™˜ê²½ì„¤ì • ---------------
library(purrr)
library(tidyverse)
library(stringr)
library(DT)

```

## 1. ì¬í˜„ê°€ëŠ¥í•œ R í”„ë¡œì íŠ¸ {#reproducible-r-project}

ìµœê·¼ R ì»¤ë®¤ë‹ˆí‹°ì—ì„œ Jenny Bryan êµìˆ˜ê°€ `setwd()`, `rm(list = ls())` ì‚¬ìš©ì„ ê¸ˆí•˜ê³ , 
í”„ë¡œì íŠ¸ + `here::here()` ì‚¬ìš©ì„ í¬í•¨í•œ ë‹¤ì–‘í•œ ëŒ€ì•ˆì„ ì œì‹œí•˜ê³  ìˆë‹¤.

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Blog post elaborating on my advice to avoid setwd() and rm(list = ls()) at top of an <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> script.<br>Wow that really touched a nerve ğŸ˜®<a href="https://t.co/YDvVUQOMKx">https://t.co/YDvVUQOMKx</a> <a href="https://t.co/b4SpNhBYUX">https://t.co/b4SpNhBYUX</a></p>&mdash; Jenny Bryan (@JennyBryan) <a href="https://twitter.com/JennyBryan/status/940436177219338240?ref_src=twsrc%5Etfw">December 12, 2017</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<img src="fig/ds-report-rmd-project.png" alt="ì¬í˜„ê°€ëŠ¥í•œ R í”„ë¡œì íŠ¸" width="77%" />

## 2. ë°ì´í„° ê³¼í•™ í”„ë¡œì íŠ¸ ìë™í™” [^ds-authoring-automation] [^minimal-r-project] {#ds-report}

[^minimal-r-project]: [A minimal Project Tree in R](https://talesofr.wordpress.com/2017/12/12/a-minimal-project-tree-in-r/)

[^ds-authoring-automation]: [ë°ì´í„° ê³¼í•™ì„ ìœ„í•œ ì €ì‘ë„êµ¬ - ë³´ê³ ì„œ ìë™í™”](https://statkclee.github.io/ds-authoring/ds-report-automation.html)

[A minimal Project Tree in R](https://aurora-mareviv.github.io/2017/12/minimal-project-tree-r/)ë¥¼ ë°”íƒ•ìœ¼ë¡œ íŒ©í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹ ,
RStudio IDEë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¬í˜„ê°€ëŠ¥í•œ R í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ì–´ë³´ëŠ” ê²ƒë„ ëŒ€ì•ˆìœ¼ë¡œ ìƒê°í•  ìˆ˜ ìˆë‹¤.

[tidyverse - Project-oriented workflow](https://www.tidyverse.org/articles/2017/12/workflow-vs-script/)ë„ ê·¸ë ‡êµ¬,
[here](https://cran.r-project.org/web/packages/here/index.html), [template](https://github.com/Pakillo/template), 
[ProjectTemplate](http://projecttemplate.net/getting_started.html) íŒ©í‚¤ì§€ë„ ë™ì¼í•œ ëª©í‘œë¥¼ ë‹¤ë¥¸ ë°©ì‹ì„ í†µí•´ ì°¾ì•„ê°€ëŠ” ê²ƒì¼ ìˆ˜ë„ ìˆë‹¤.


## 3. R í”„ë¡œì íŠ¸ ê°œìš” {#ds-project-environment}

ì¬í˜„ê°€ëŠ¥í•œ ë°ì´í„° ê³¼í•™ì„ ìœ„í•´ì„œ í•µì‹¬ìœ¼ë¡œ ë‹¤ìŒ ì‚¬í•­ì´ ì¬í˜„ê°€ëŠ¥í•´ì•¼ í•œë‹¤.

- ë°ì´í„°: `data`
- R ì½”ë“œ: `code`
- ì¤‘ê°„ ì‚°ì¶œ ë°ì´í„°: `data-processed`
- ê·¸ë˜í”„(Plot): `plot`
- ë§ˆí¬ë‹¤ìš´ ë³´ê³ ì„œ (ì´ë¯¸ì§€ í¬í•¨): `report`

RStudio IDEë¥¼ í†µí•´ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ê³  ë‚˜ì„œ `code`, `data`, `data-processed`, `img`, `report` ë””ë ‰í† ë¦¬ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ìƒì„±ì‹œí‚¨ë‹¤.

``` {r r-project-tree, eval = FALSE}
+-project\  
  +-- code\
  +-- data\
  +-- data-processed\
  +-- plot
  +-- img\
  +-- report\
```

## 4. R í”„ë¡œì íŠ¸ ì‚¬ë¡€ {#ds-project-example}

### 4.1. í™˜ê²½ì„¤ì • {#ds-project-example-setup}

ì¬í˜„ê°€ëŠ¥í•œ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ë©° ê°€ì¥ ë¨¼ì € í™˜ê²½ì„¤ì • ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.

í˜„ì¬ ì‘ì—… ë””ë ‰í† ë¦¬ `wdir`ë¥¼ ì§€ì •í•˜ê³ , ìˆœì°¨ì ìœ¼ë¡œ 
ë°ì´í„° `data_dir`,
ì¤‘ê°„ ë°ì´í„° `data_processed_dir`,
ì™¸ë¶€ ì´ë¯¸ì§€ ë””ë ‰í† ë¦¬ `img_dir`,
ë°ì´í„° ë¶„ì„ ê²°ê³¼ë¥¼ ê·¸ë˜í”„ë¡œ ì €ì¥í•˜ëŠ” ë””ë ‰í† ë¦¬ `plot_dir`,
ë³´ê³ ì„œ ë””ë ‰í† ë¦¬ `report_dir` ë¡œ ì§€ì •í•œë‹¤.

```  {r reproducible-r-project-example, eval=FALSE}
# 0. ê°œìš” --------------- 
# ë°ì´í„° ê³¼í•™ í”„ë¡œì íŠ¸ ì‹œì‘ 

# 1. í™˜ê²½ì„¤ì • ----------
## 1.1. íŒ©í‚¤ì§€ ì„¤ì¹˜ ë° ë¶ˆëŸ¬ì˜¤ê¸°
list.of.packages <- c("tidyverse", "readxl")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages, repos='https://cran.rstudio.com/')

library(tidyverse)
library(readxl)

## 1.2. ë°ì´í„°ê³¼í•™ í™˜ê²½ì„¤ì •
# ë³´ê³ ì„œ Rmd ì„¤ì •  
params <- NULL
params$dataname <- "mpg_cars"

# í˜„ì¬ ì‘ì—… ë””ë ‰í† ë¦¬
wdir <- getwd() 
# ë°ì´í„° ë””ë ‰í† ë¦¬
data_dir <- file.path(wdir, "data") # datadir <- paste(wdir, "/data", sep="") ì„¤ì •ë³´ë‹¤ ë” ì¢‹ìŒ.
# ì¤‘ê°„ ë°ì´í„° ì €ì¥
data_processed_dir <- file.path(wdir, "data_processed")

# ì™¸ë¶€ ì´ë¯¸ì§€ ë””ë ‰í† ë¦¬
img_dir <- file.path(wdir, "img")
# ë°ì´í„° ë¶„ì„ ê²°ê³¼ ê·¸ë˜í”„ ì €ì¥ 
plot_dir <- file.path(wdir, "plot")

# ë³´ê³ ì„œ ë””ë ‰í† ë¦¬
report_dir <- file.path(wdir, "report")
```

### 4.2. ë°ì´í„° ê°€ì ¸ì˜¤ê¸° {#ds-project-example-setup-import}

ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” ë¶€ë¶„ì„ í•˜ë“œì½”ë”©í•˜ê¸° ë³´ë‹¤ ì•ì„œ ì„¤ì •í•œ `wdir`, `data_dir` ì •ë³´ë¥¼ ì°¸ì¡°í•˜ì—¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤.

```  {r reproducible-r-project-example-run-import, eval=FALSE}
# 2. ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ------------------------
dataname <- params$dataname 
routexl <- paste(data_dir, "/", dataname, ".xlsx", sep="")
xls_dat <- read_excel(routexl, sheet = 1)
```

### 4.3. ë°ì´í„° ë¶„ì„, ëª¨í˜•ê°œë°œ ë° ì‹œê°í™” {#ds-project-example-setup-eda-model-viz}

ë³¸ê²©ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê¸° ì•ì„œ ì „ì²˜ë¦¬ ì‘ì—…ì„ í†µí•´ ëª¨í˜•ê°œë°œ ë° ì‹œê°í™”ì— ì í•©í•œ í˜•íƒœë¡œ 
ë°ì´í„°ë¥¼ ê°€ê³µí•œë‹¤. 

```  {r reproducible-r-project-example-run-model-viz, eval=FALSE}
# 3. ë°ì´í„° ì „ì²˜ë¦¬ ------------------------

xls_df <- xls_dat %>% 
  mutate(ratio = dist/speed)

# 4. ë°ì´í„° ì‹œê°í™” ------------------------

cars_g <- xls_df %>% 
  ggplot(aes(x=speed, y=dist)) +
  geom_point()

cars_g
```

### 4.4. ë°ì´í„° ë° ëª¨í˜•, ì‹œê°í™” ì‚°ì¶œë¬¼ ë‚´ë³´ë‚´ê¸° {#ds-project-example-export}

`plot_dir`, `data_processed_dir` ì•ì„œ ì •ì˜í•œ ë””ë ‰í† ë¦¬ë¡œ ë¶„ì„ ê²°ê³¼ ì¤‘ê°„ ë°ì´í„°, ê·¸ë˜í”„, R ê°ì²´ë¥¼ ë‚´ë³´ë‚´ì–´ ì €ì¥í•œë‹¤.

```  {r reproducible-r-project-example-run-export, eval=FALSE}
# 5. ì €ì¥ ë° ë‚´ë³´ë‚´ê¸°  ------------------------
## 5.1. ì´ë¯¸ì§€ ì €ì¥ 
plot_name <- "cars_g.png"
save_plot <- file.path(plot_dir, plot_name)

ggsave(save_plot)  # (see http://ggplot2.tidyverse.org/reference/ggsave.html)

## 5.2. ë°ì´í„° ì €ì¥
save.image(file="data_processed/whole_env.RData")
saveRDS(xls_df, "data_processed/mpg_cars.rds")
```

## 5. ë³´ê³ ì„œ Rmd {#ds-project-example-rmd}

ë³´ê³ ì„œë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒë„ ìœ ì‚¬í•˜ë‹¤. ë‹¤ë§Œ ëª‡ê°€ì§€ ì‚¬í•­ì— ëŒ€í•´ì„œ ì‚¬ì „ ì ê²€ì„ í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.

- YAML í—¤ë”: `params`ë¥¼ í†µí•´ `data_name` ì„ ë¹„ë¡¯í•œ ë§¤ê°œë³€ìˆ˜ì— ëŒ€í•œ ì„¤ì •ì„ ìˆ˜í–‰í•œë‹¤. 
- ë³´ê³ ì„œ íŒŒì¼ ë£¨íŠ¸ ì„¤ì •: `knitr::opts_knit$set(root.dir = "../")` ì„¤ì •ì„ í†µí•´ `.Rmd` íŒŒì¼ì´ ìœ„ì¹˜í•œ ê³³ì´ ì•„ë‹ˆë¼ í”„ë¡œì íŠ¸ ìœ„ì¹˜ë¥¼ ë£¨íŠ¸ë¡œ ë™ì¼í•˜ê²Œ ì„¤ì •í•œë‹¤.

<img src="fig/ds-report-rmd.png" alt="ë³´ê³ ì„œ Rmd ì˜ˆì œ"/>

### 5.1. YAML í—¤ë” {#ds-project-example-rmd-yaml}

YAML í—¤ë”ì— ê¸°ë³¸ì ì¸ ì„¤ì •ì„ í•˜ê³  ë°ì´í„°ëª…(`mpg_cars`)ì„ ë§¤ê°œë³€ìˆ˜(`params$data_name`)ë¡œ ëª…ì‹œí•œë‹¤.

> ``` {r r-project-rmd-yaml, eval=FALSE}
> ---
> title: "ë°ì´í„° ê³¼í•™ í”„ë¡œì íŠ¸"
> author: "xwMOOC"
> date: "`r Sys.Date()`"
> output:
>   html_document:
>     toc: yes
>     highlight: tango
> editor_options: 
>   chunk_output_type: console
> params:
>    data_name: "mpg_cars"
> ---
> ```

### 5.2. ë£¨íŠ¸ ì„¤ì • {#ds-project-example-rmd-root}

ë³´ê³ ì„œ `.Rmd` íŒŒì¼ì€ `report` ë””ë ‰í† ë¦¬ì— ìœ„ì¹˜í•˜ê³  ìˆì–´ `root.dir`ì„ í†µí•´ ë³„ë„ë¡œ í”„ë¡œì íŠ¸ ë£¨íŠ¸ë¥¼ ì„¤ì •í•œë‹¤.

> ``` {r r-project-rmd-knitr, eval=FALSE}
> knitr::opts_chunk$set(collapse = TRUE, echo=TRUE)
> knitr::opts_knit$set(root.dir = "../")
> ```

### 5.3. í™˜ê²½ì„¤ì •  {#ds-project-example-rmd-configuration}

R ìŠ¤í¬ë¦½íŠ¸ë¥¼ ê°œë°œí•  ë•Œì™€ ë™ì¼í•œ í™˜ê²½ì„ êµ¬í˜„í•˜ì—¬ ë³´ê³ ì„œì—ì„œ ì‘ì„±í•˜ëŠ” ê²°ê³¼ê°€ í”ë“¤ë¦¬ì§€ ì•Šê²Œ ì§€ì •í•œë‹¤.

> ``` {r r-project-rmd-main, eval=FALSE}
> # 1. í™˜ê²½ì„¤ì • ----------
> ## 1.1. íŒ©í‚¤ì§€ ì„¤ì¹˜ ë° ë¶ˆëŸ¬ì˜¤ê¸°
> list.of.packages <- c("tidyverse", "readxl")
> new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
> if(length(new.packages)) install.packages(new.packages, repos='https://cran.rstudio.com/')
> 
> library(tidyverse)
> library(readxl)
> library(png)
> library(grid)
> 
> 1.2. ë°ì´í„°ê³¼í•™ í™˜ê²½ì„¤ì •
> í˜„ì¬ ì‘ì—… ë””ë ‰í† ë¦¬
> wdir <- getwd() 
> 
> ë°ì´í„° ë””ë ‰í† ë¦¬
> data_dir <- file.path(wdir, "data")
> ì¤‘ê°„ ë°ì´í„° ì €ì¥
> data_processed_dir <- file.path(wdir, "data_processed")
> 
> ì™¸ë¶€ ì´ë¯¸ì§€ ë””ë ‰í† ë¦¬
> img_dir <- file.path(wdir, "img")
> path_img_filename <- paste0(img_dir, "/", "Rlogo.png")
> ë°ì´í„° ë¶„ì„ ê²°ê³¼ ê·¸ë˜í”„ ì €ì¥ 
> plot_dir <- file.path(wdir, "plot")
> 
> 2. ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ----------
> data_name <- params$data_name
> path_file_rds <- paste(data_processed_dir, "/", data_name, ".rds", sep="")
> 
> xls_df <- readRDS(path_file_rds)
> ```

### 5.4. ì™¸ë¶€ ì´ë¯¸ì§€, ë¶„ì„ ëŒ€ìƒ ë°ì´í„°, ê¸°ìˆ í†µê³„ ë“±  {#ds-project-example-rmd-main}

ì™¸ë¶€ ì´ë¯¸ì§€ë¥¼ ë¹„ë¡¯í•œ í•„ìš”í•œ ì„¤ì •ë„ ë™ì¼í•˜ê²Œ ê°€ì ¸ì™€ì„œ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³ , ëª¨í˜• ê°œë°œ, ì‹œê°í™”ë¥¼ ì§„í–‰í•œë‹¤.

> ``` {r r-project-rmd-table-etc, eval=FALSE}
> img <- readPNG(path_img_filename)
> grid.raster(img)
> 
> 
> 1. ë¶„ì„ ëŒ€ìƒ ë°ì´í„° {#data-importation}
> 
> DT::datatable(xls_df)
> 
> 
> 2. ê¸°ìˆ  í†µê³„ ë¶„ì„ {#descriptive-stats}
> 
> summary(xls_df)
> 
> 3. ë°ì´í„° ì‹œê°í™” {#mpg-data-visualization}
> 
> xls_df %>% 
>   ggplot(aes(x=speed, y=dist)) +
>   geom_point()
> ```


